name: orders
type: resource.web.app
description: A microservice for placing boat tour orders
provides:
  - type: service.web.app
    name: orders_service
    description: A microservice to manage order details
    params:
      - name: orders_endpoint
        value: /orders
      - name: port
        value: 3003
      - name: imageName
        formula: '{{.Component.Name}}'
uses:
  - type: environment
    params:
      - name: DB_USER
        formula: '{{with(index .Needs "service.db.postgres:ordersdb")}}{{.Params.db_username.Value}}{{end}}'
      - name: DB_PW
        formula: '{{with(index .Needs "service.db.postgres:ordersdb")}}{{.Params.db_password.Value}}{{end}}'
      - name: DB_PORT
        formula: '{{with(index .Needs "service.db.postgres:ordersdb")}}{{.Params.db_port.Value}}{{end}}'
      - name: DB_NAME
        formula: '{{with(index .Needs "service.db.postgres:ordersdb")}}{{.Params.db_name.Value}}{{end}}'
      - name: DB_HOST
        formula: '{{with(index .Needs "service.db.postgres:ordersdb")}}{{.Params.db_host.Value}}{{end}}'
needs:
  - type: service.db.postgres
    name: ordersdb
    description: Back-end database
    params:
      - name: db_username
        required: true
      - name: db_password
        required: true
      - name: db_port
        required: true
      - name: db_name
        required: true
      - name: db_host
        required: true
